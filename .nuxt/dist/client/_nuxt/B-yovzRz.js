import{f as _,g as M,h as R,i as b,j as B,c as F,b as e,e as n,w as d,k as N,v as T,l as a,F as Y,m as S,y,p as j,r as z,o as H,q as w,C as h,D as V}from"./OmrnE3d5.js";import{_ as L}from"./B-r68-ay.js";import{u as x}from"./I6A_oj8C.js";import{b as O}from"./BKZYPkvF.js";import{f as X}from"./C0vxPmJo.js";import{U as A,X as I,a as G,D as J}from"./VsOuaCTX.js";const K={class:"breadcrumb__area include-bg pb-40 pt-30 grey-bg-4"},P={class:"container"},Q={class:"row"},W={class:"col-xxl-12"},Z={class:"breadcrumb__content p-relative z-index-1"},ee={class:"breadcrumb__list"},le=e("span",null," จัดการข้อมูล ",-1),te=e("span",{class:"dvdr"},[e("i",{class:"fa-solid fa-circle-small"})],-1),ae=e("span",{class:"dvdr"},[e("i",{class:"fa-solid fa-circle-small"})],-1),se=e("span",null," เพิ่มข้อมูล ",-1),oe={class:"portfolio__area pt-40 pb-40"},ne={class:"container"},ie={class:"row"},re=e("div",{class:"col-12"},[e("h4",null,"แบบฟอร์มเพิ่มข้อมูล")],-1),de={class:"col-12"},ue={class:""},ce={class:""},_e={class:"form-group row mt-10"},pe=e("label",{for:"",class:"label label-required"},"หน่วยงาน : ",-1),me={class:"form-group row mt-10"},he=e("label",{for:"",class:"label label-required"},"ประเภทข่าว : ",-1),ve={class:"form-group row mt-10"},fe=e("label",{for:"",class:"label label-required"},"ประเภทการบริการวิชาการ : ",-1),be={class:"form-group row mt-10"},ye=e("label",{for:"",class:"label label-required"},"รูปภาพปก : ",-1),we={class:"form-group row mt-10"},ge=e("label",{for:"",class:"label label-required"},"หัวข้อ : ",-1),Ve={class:"form-group row mt-10"},xe=e("label",{for:"",class:"label label-required"},"เนื้อหาข่าว : ",-1),$e=e("div",{id:"detail-th"},null,-1),ke={class:"form-group row mt-10"},De=e("label",{for:"",class:"label label-required"},"วันที่ลงข้อมูล : ",-1),Ee={class:"form-group row mt-10"},Ue=e("label",{for:"",class:"label"},"รูปภาพเพิ่มเติม : ",-1),Ce={class:"form-group row mt-10"},qe=e("label",{for:"",class:"label label-required"},"สถานะ : ",-1),Se={__name:"add",setup(Me){_.extend(M);const $=S(),{apiBase:c}=$.public,k=R(),t=b({title_th:null,title_en:null,detail_th:"",detail_en:"",news_type_id:null,created_news:_(),is_publish:{id:1,value:1,name_th:"publish",name_en:"publish",color:"success"}}),v=b(null),u=b({publishes:O.data().publishes,news_types:[],departments:[],service_categories:[]}),D=o=>{const l=_(o).locale("th").format("DD"),i=_(o).locale("th").format("MMM"),r=o.getFullYear()+543;return`${l} ${i} ${r}`},g=(Math.random()+1).toString(36).substring(7),p=new A({meta:{news_id:null,secret_key:g,news_gallery_id:null,table_name:"news"},debug:!0,restrictions:{allowedFileTypes:["image/*","video/*"]}}).use(I,{endpoint:`${c}/froala/uppy`,fieldName:"file"});p.on("upload-success",(o,l)=>{p.setFileMeta(o.id,{url:l.body.link,news_id:l.body.news_id,news_gallery_id:l.body.news_gallery_id})}),p.on("file-removed",(o,l)=>{o.meta.news_gallery_id!=null&&$fetch(`${c}/news-gallery/${o.meta.news_gallery_id}`,{method:"DELETE"}).then(i=>{i.msg=="success"?console.log("success"):console.log("error")}).catch(i=>i.data)});let f={};f.detail_th=X.data().froala_config(),f.detail_th.events={keyup:function(o){t.value.detail_th=this.html.get()},click:function(o){t.value.detail_th=this.html.get()},"commands.after":function(o,l,i){t.value.detail_th=this.html.get()},"paste.after":function(o){t.value.detail_th=this.html.get()},initialized:function(){this.html.insert(t.value.detail_th)}};const E=async()=>{let o=await $fetch(`${c}/news-type`,{params:{is_publish:1}}).catch(l=>l.data);u.value.news_types=o.data.map(l=>({title:l.name_th,value:l.id}))},U=async()=>{let o=await $fetch(`${c}/department`,{params:{is_publish:1}}).catch(l=>l.data);u.value.departments=o.data.map(l=>({title:l.name_th,value:l.id})).filter(l=>y("user").value&&y("user").value.group_id==2?l.value==y("user").value.department_id:!0)},C=async()=>{let o=await $fetch(`${c}/service-category`,{params:{is_publish:1}}).catch(l=>l.data);u.value.service_categories=o.data.map(l=>({title:l.name_th,value:l.id}))},q=async()=>{if(t.value.is_publish==null||t.value.is_publish.value==null||t.value.news_type_id==null||t.value.news_type_id.value==null||t.value.department_id==null||t.value.department_id.value==null||t.value.title_th==""||t.value.title_th==null||t.value.detail_th==""||t.value.detail_th==null){x("โปรดระบุข้อมูลให้ครบถ้วน","error");return}let o={text_success:"เพิ่มรายการเสร็จสิ้น",method:"post",url:c+"/news/"},l=[];t.value.service_category_id.length!=0&&t.value.service_category_id.forEach(s=>{l.push(s.value)});let i={...t.value,secret_key:g,news_file:v.value.files!=null?v.value.files[0]:null,news_type_id:t.value.news_type_id==null?void 0:t.value.news_type_id.value,department_id:t.value.department_id==null?void 0:t.value.department_id.value,service_category_id:t.value.service_category_id==null?void 0:l,created_news:_().format("YYYY-MM-DD"),is_publish:t.value.is_publish.value};var r=new FormData;for(var m in i)r.append(m,i[m]);await $fetch(o.url,{method:o.method,body:r}).then(s=>{if(s.msg=="success")x(o.text_success,"success"),k.push({path:"/admin/news/"+s.id});else throw new Error("ERROR")}).catch(s=>s.data)};return B(()=>{E(),U(),C()}),(o,l)=>{const i=j,r=L,m=z("froala");return H(),F(Y,null,[e("section",K,[e("div",P,[e("div",Q,[e("div",W,[e("div",Z,[e("div",ee,[le,te,e("span",null,[n(i,{href:"/admin/news"},{default:d(()=>[w(" รายการข่าว ")]),_:1})]),ae,se])])])])])]),e("section",oe,[e("div",ne,[e("div",ie,[re,e("div",de,[e("div",ue,[e("div",ce,[e("div",_e,[pe,e("div",null,[n(r,null,{default:d(()=>[n(a(h),{label:"title",placeholder:"หน่วยงาน",options:a(u).departments,modelValue:a(t).department_id,"onUpdate:modelValue":l[0]||(l[0]=s=>a(t).department_id=s),class:"v-select-no-border",clearable:!0},null,8,["options","modelValue"])]),_:1})])]),e("div",me,[he,e("div",null,[n(r,null,{default:d(()=>[n(a(h),{label:"title",placeholder:"ประเภทข่าว",options:a(u).news_types,modelValue:a(t).news_type_id,"onUpdate:modelValue":l[1]||(l[1]=s=>a(t).news_type_id=s),class:"v-select-no-border",clearable:!0},null,8,["options","modelValue"])]),_:1})])]),e("div",ve,[fe,e("div",null,[n(r,null,{default:d(()=>[n(a(h),{label:"title",placeholder:"ประเภทการบริการวิชาการ",options:a(u).service_categories,modelValue:a(t).service_category_id,"onUpdate:modelValue":l[2]||(l[2]=s=>a(t).service_category_id=s),multiple:"",class:"v-select-no-border",clearable:!0},null,8,["options","modelValue"])]),_:1})])]),e("div",be,[ye,e("div",null,[e("input",{ref_key:"file",ref:v,class:"form-control",type:"file",id:"formFile"},null,512)])]),e("div",we,[ge,e("div",null,[N(e("input",{type:"text",class:"form-control form-control-plaintext","onUpdate:modelValue":l[3]||(l[3]=s=>a(t).title_th=s)},null,512),[[T,a(t).title_th]])])]),e("div",Ve,[xe,e("div",null,[n(r,null,{default:d(()=>[n(m,{tag:"textarea",config:a(f).detail_th,modelValue:a(t).detail_th,"onUpdate:modelValue":l[4]||(l[4]=s=>a(t).detail_th=s)},null,8,["config","modelValue"]),$e]),_:1})])]),e("div",ke,[De,e("div",null,[n(a(G),{modelValue:a(t).created_news,"onUpdate:modelValue":l[5]||(l[5]=s=>a(t).created_news=s),"enable-time-picker":!1,locale:"th","auto-apply":"",format:D},{"year-overlay-value":d(({text:s})=>[w(V(parseInt(s)+543),1)]),year:d(({year:s})=>[w(V(s+543),1)]),_:1},8,["modelValue"])])]),e("div",Ee,[Ue,e("div",null,[n(r,null,{default:d(()=>[n(a(J),{uppy:a(p),ref:"dash",style:{width:"100%"},props:{doneButtonHandler:null,hideCancelButton:!0,showRemoveButtonAfterComplete:!0}},null,8,["uppy"])]),_:1})])]),e("div",Ce,[qe,e("div",null,[n(r,null,{default:d(()=>[n(a(h),{label:"name_th",placeholder:"การเผยแพร่",options:a(u).publishes,id:"slt-is_publish",modelValue:a(t).is_publish,"onUpdate:modelValue":l[6]||(l[6]=s=>a(t).is_publish=s),class:"v-select-no-border",clearable:!0},null,8,["options","modelValue"])]),_:1})])]),e("div",{class:"col-md-12 mt-20"},[e("div",{class:"contact__btn-2 text-center"},[e("button",{class:"btn btn-primary",onClick:q}," บันทึก ")])])])])])])])])],64)}}};export{Se as default};
