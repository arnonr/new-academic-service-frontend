import{_ as R}from"./B-r68-ay.js";import{s as L,h as M,i,t as b,z as T,j,A as z,u as G,c as y,b as l,F as C,d as D,k as H,v as J,l as o,e as q,B as K,x as B,m as Q,ab as w,o as _,w as S,G as I,C as W,ar as X,ac as Y}from"./OmrnE3d5.js";const Z={class:"portfolio__area pt-40 pb-40"},ee={class:"container"},te={class:"row"},ae={class:"col-md-4 mb-20"},se={key:0,class:"container"},le={class:"row"},oe={class:"col-lg-12"},re={class:"row"},ne={class:"col-xl-12"},ce={class:"blog__list-item-wrapper"},ie={class:"col-xxl-12"},ue={class:"tp-pagination mt-30"},pe={__name:"index",async setup(de){let s,u;const v=L(),$=M(),N=Q(),{apiBase:P}=N.public,g=i([]),U=i(12),n=i(parseInt(v.query.page)||1),p=i(1),f=i(0),t=i({department_id:null,service_category_id:null,title:"",created_year:null,created_month:null,is_publish:1,text_all:""}),A=[{options:"service_categories",model:"service_category_id",label:"title",placeholder:"ประเภทงานบริการวิชาการ"},{options:"departments",model:"department_id",label:"title",placeholder:"หน่วยงาน"}],m=i({news_types:[],perPage:[{title:"20",value:20},{title:"40",value:40},{title:"60",value:60}],service_categories:[],departments:[]}),k=async(a,c={})=>{try{const{data:r}=await $fetch(`${P}/${a}`,{params:c});return r.map(e=>({title:e.name_th,value:e.id}))}catch(r){return console.error("Error fetching ",r),[]}},E=a=>({link:"serve/",id:a.id,title:a.title,file:a.serve_file,created:a.created_serve,type_name:a.service_category.name_th,dep_name:a.department.name_th}),{data:F}=([s,u]=b(()=>w("departments",()=>k("department",{is_publish:1}))),s=await s,u(),s);m.value.departments=F.value;const{data:O}=([s,u]=b(()=>w("service-categories",()=>k("service-category",{is_publish:1}))),s=await s,u(),s);m.value.service_categories=O.value,v.query.service_category_id!=null&&(t.value.service_category_id=m.value.service_categories.find(a=>a.value==v.query.service_category_id)),v.query.page&&(n.value=v.query.page);const{data:x}=([s,u]=b(async()=>w("serve",async()=>{var e,d,h,V;let a=t.value.text_all.length>3?t.value.text_all:"",c={...t.value,text_all:a,service_category_id:(e=t.value.service_category_id)==null?void 0:e.value,department_id:(d=t.value.department_id)==null?void 0:d.value,created_year:(h=t.value.created_year)==null?void 0:h.value,created_month:(V=t.value.created_month)==null?void 0:V.value,perPage:U.value,currentPage:n.value},r=await $fetch(`${P}/serve`,{params:c});return g.value=r.data,p.value=r.totalPage,f.value=r.totalData,r})),s=await s,u(),s);return g.value=x.value.data,p.value=x.value.totalPage,f.value=x.value.totalData,T([n,t],()=>{$.replace({name:"serve",query:{page:n.value}}),Y("serve")},{deep:!0}),j(async()=>{}),z(()=>{n.value>p.value&&(n.value=p.value)}),G({title:"งานบริการวิชาการ มจพ."}),(a,c)=>{const r=R;return _(),y("section",Z,[l("div",ee,[l("div",te,[(_(),y(C,null,D(A,(e,d)=>l("div",{key:d,class:"col-md-4 mb-20"},[q(r,null,{default:S(()=>[o(m)[e.options].length?(_(),I(o(W),{key:0,modelValue:o(t)[e.model],"onUpdate:modelValue":h=>o(t)[e.model]=h,label:e.label,placeholder:e.placeholder,options:o(m)[e.options],class:"v-select-no-border",clearable:!0},null,8,["modelValue","onUpdate:modelValue","label","placeholder","options"])):B("",!0)]),_:2},1024)])),64)),l("div",ae,[H(l("input",{"onUpdate:modelValue":c[0]||(c[0]=e=>o(t).text_all=e),class:"form-control",type:"text",placeholder:"ค้นหางานบริการวิชาการ (พิมพ์ 3 ตัวอักษร)"},null,512),[[J,o(t).text_all]])])])]),o(g).length!=0?(_(),y("div",se,[l("div",le,[l("div",oe,[l("div",re,[l("div",ne,[l("div",ce,[(_(!0),y(C,null,D(o(g),(e,d)=>(_(),I(X,{key:d,item:E(e)},null,8,["item"]))),128))])]),l("div",ie,[l("div",ue,[q(K,{totalPage:o(p),currentPage:o(n),totalItems:o(f),"onUpdate:currentPage":c[1]||(c[1]=e=>n.value=e)},null,8,["totalPage","currentPage","totalItems"])])])])])])])):B("",!0)])}}};export{pe as default};
