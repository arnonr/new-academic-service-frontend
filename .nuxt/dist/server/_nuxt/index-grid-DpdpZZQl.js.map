{"version":3,"file":"index-grid-DpdpZZQl.js","sources":["../../../../pages/news/index-grid.vue"],"sourcesContent":["<template>\n    <section class=\"portfolio__area pt-40 pb-40\">\n        <div class=\"container\" v-if=\"items.length != 0\">\n            <div class=\"row\">\n                <div class=\"col-lg-12\">\n                    <div class=\"row\">\n                        <div class=\"col-xl-12\">\n                            <div class=\"blog__list-item-wrapper\">\n                                <div class=\"row gx-2 grid\">\n                                    <NewsListItem\n                                        v-for=\"(it, i) in items\"\n                                        :key=\"i\"\n                                        class=\"col-xxl-3 col-xl-3 col-lg-6 col-md-6\"\n                                        :item=\"{\n                                            link: '/news/',\n                                            id: it.id,\n                                            title: it.title,\n                                            file: it.news_file,\n                                            created: it.created_news,\n                                            type_name: it.news_type.name,\n                                        }\"\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-xxl-12\">\n                            <div class=\"tp-pagination mt-30\">\n                                <blog-pagination\n                                    :totalPage=\"totalPage\"\n                                    :currentPage=\"currentPage\"\n                                    :totalItems=\"totalItems\"\n                                    @update:currentPage=\"currentPage = $event\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport vSelect from \"vue-select\";\nimport \"vue-select/dist/vue-select.css\";\n// Import\nimport NewsListItem from \"~/components/list/GridItem.vue\";\nimport BlogPagination from \"~/components/common/pagination/BlogPagination.vue\";\n// Variable\nconst route = useRoute();\nconst router = useRouter();\nconst runtimeConfig = useRuntimeConfig();\nconst items = ref([]);\nconst perPage = ref(12);\nconst currentPage = ref(1);\nconst totalPage = ref(1);\nconst totalItems = ref(0);\nconst search = ref({\n    news_type: null,\n    created_year: null,\n    created_month: null,\n    is_publish: 1,\n});\n\nconst props = defineProps({\n    props_item: {\n        type: Object,\n        required: true,\n    },\n});\n\nconst selectOptions = ref({\n    news_types: [],\n    perPage: [\n        { title: \"20\", value: 20 },\n        { title: \"40\", value: 40 },\n        { title: \"60\", value: 60 },\n    ],\n    years: [],\n    months: [\n        { title: \"มกราคม\", title_en: \"January\", value: \"01\" },\n        { title: \"กุมภาพันธ์\", title_en: \"February\", value: \"02\" },\n        { title: \"มีนาคม\", title_en: \"March\", value: \"03\" },\n        { title: \"เมษายน\", title_en: \"April\", value: \"04\" },\n        { title: \"พฤษภาคม\", title_en: \"May\", value: \"05\" },\n        { title: \"มิถุนายน\", title_en: \"June\", value: \"06\" },\n        { title: \"กรกฎาคม\", title_en: \"July\", value: \"07\" },\n        { title: \"สิงหาคม\", title_en: \"August\", value: \"08\" },\n        { title: \"กันยายน\", title_en: \"September\", value: \"09\" },\n        { title: \"ตุลาคม\", title_en: \"October\", value: \"10\" },\n        { title: \"ฑฤศจิกายน\", title_en: \"November\", value: \"11\" },\n        { title: \"ธันวาคม\", title_en: \"December\", value: \"12\" },\n    ],\n});\n\nlet year = dayjs().year();\n\nfor (let i = 0; i <= 9; i++) {\n    selectOptions.value.years.push({\n        title: year - i + 543,\n        title_en: year - i,\n        value: year - i,\n    });\n}\n\n// Function Fetch\nconst { data: resNewsType } = await useAsyncData(\"newsType\", async () => {\n    let data = await $fetch(`${runtimeConfig.public.apiBase}/news-type`, {\n        params: {\n            is_publish: 1,\n        },\n    });\n\n    return data;\n});\n\nselectOptions.value.news_types = resNewsType.value.data.map((e) => {\n    return { title: e.name, value: e.id };\n});\n\nif (route.query.page) {\n    currentPage.value = route.query.page;\n}\n\nconst { data: res } = await useAsyncData(\"news\", async () => {\n    let params = {\n        ...search.value,\n        news_type_id:\n            search.value.news_type == null\n                ? undefined\n                : search.value.news_type.value,\n        created_year:\n            search.value.created_year == null\n                ? undefined\n                : search.value.created_year.value,\n        created_month:\n            search.value.created_month == null\n                ? undefined\n                : search.value.created_month.value,\n        department_id: props.props_item.department_id,\n        perPage: perPage.value,\n        currentPage: currentPage.value,\n    };\n\n    let data = await $fetch(`${runtimeConfig.public.apiBase}/news`, {\n        params: params,\n    });\n    items.value = data.data;\n    totalPage.value = data.totalPage;\n    totalItems.value = data.totalData;\n    return data;\n});\n\nitems.value = res.value.data;\ntotalPage.value = res.value.totalPage;\ntotalItems.value = res.value.totalData;\n\nwatch(\n    [currentPage, search],\n    () => {\n        router.replace({\n            name: \"news\",\n            query: { page: currentPage.value },\n        });\n        refreshNuxtData(\"news\");\n    },\n    { deep: true }\n);\n\nonMounted(() => {});\n\nwatchEffect(() => {\n    if (currentPage.value > totalPage.value)\n        currentPage.value = totalPage.value;\n});\n\n// watch([res], () => {\n//   items.value = res.value.data;\n// });\n\n// watch([resNewsType], () => {\n//   newsType.value = resNewsType.value.data;\n// });\n\nuseHead({\n    title: \"ข่าวและประกาศ\",\n});\n\ndefinePageMeta({\n    middleware: \"auth\",\n});\n</script>\n\n<style scoped></style>\n"],"names":["_withAsyncContext"],"mappings":"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"}