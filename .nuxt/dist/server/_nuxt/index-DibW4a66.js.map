{"version":3,"file":"index-DibW4a66.js","sources":["../../../../pages/admin/news/index.vue"],"sourcesContent":["<template>\n    <section class=\"breadcrumb__area include-bg pb-40 pt-30 grey-bg-4\">\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-xxl-12\">\n                    <div class=\"breadcrumb__content p-relative z-index-1\">\n                        <div class=\"breadcrumb__list\">\n                            <span> จัดการข้อมูล </span>\n                            <span class=\"dvdr\"\n                                ><i class=\"fa-solid fa-circle-small\"></i\n                            ></span>\n                            <span> ข่าวประชาสัมพันธ์ </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"portfolio__area pt-40\">\n        <div class=\"container\">\n            <div class=\"mt-10 mb-30 pl-10 pt-15 pb-10 bg-grey\">\n                <h4 class=\"section-bg-primary mb-20\">\n                    <i class=\"fa-solid fa-search\"></i>\n                    <span class=\"ml-10\">ค้นหา</span>\n                </h4>\n\n                <div class=\"row\">\n                    <div class=\"col-12 col-lg-4\">\n                        <input\n                            class=\"form-control\"\n                            v-model=\"search.title_th\"\n                            name=\"title_th\"\n                            type=\"text\"\n                            placeholder=\"หัวข้อข่าว (TH)\"\n                        />\n                    </div>\n\n                    <div\n                        class=\"col-12 col-lg-4\"\n                        v-if=\"selectOptions.news_types.length != 0\"\n                    >\n                        <client-only>\n                            <v-select\n                                label=\"title\"\n                                placeholder=\"ประเภทข่าว\"\n                                :options=\"selectOptions.news_types\"\n                                v-model=\"search.news_type_id\"\n                                class=\"v-select-no-border\"\n                                :clearable=\"true\"\n                            ></v-select\n                        ></client-only>\n                    </div>\n\n                    <div\n                        class=\"col-12 col-lg-4\"\n                        v-if=\"selectOptions.departments.length != 0\"\n                    >\n                        <client-only>\n                            <v-select\n                                label=\"title\"\n                                placeholder=\"หน่วยงาน\"\n                                :options=\"selectOptions.departments\"\n                                v-model=\"search.department_id\"\n                                class=\"v-select-no-border\"\n                                :clearable=\"true\"\n                            ></v-select\n                        ></client-only>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"portfolio__area pt-40 pb-40\">\n        <div class=\"container\">\n            <div class=\"mt-10 mb-30 pl-10 pt-15 pb-10 bg-grey\">\n                <h4 class=\"section-bg-primary mb-20\">\n                    <i class=\"fa-regular fa-news\"></i>\n                    <span class=\"ml-10\">รายการข่าวประชาสัมพันธ์</span>\n                </h4>\n\n                <div class=\"mb-20\">\n                    <button\n                        type=\"button\"\n                        class=\"btn btn-primary\"\n                        @click=\"\n                            () => {\n                                $router.push({ path: '/admin/news/add' });\n                            }\n                        \"\n                    >\n                        <i class=\"fa-regular fa-plus\"></i> เพิ่มข้อมูล\n                    </button>\n                </div>\n\n                <div class=\"row gx-2 grid\">\n                    <div class=\"col-12\">\n                        <div class=\"table-responsive\">\n                            <table\n                                class=\"table table-bordered table-striped table-admin\"\n                            >\n                                <thead>\n                                    <tr>\n                                        <th class=\"text-center\"></th>\n                                        <th class=\"text-center\">ชื่อ (TH)</th>\n                                        <th class=\"text-center\">ประเภทข่าว</th>\n                                        <th class=\"text-center\">หน่วยงาน</th>\n                                        <th class=\"text-center\">\n                                            วันที่ลงข่าว\n                                        </th>\n                                        <th class=\"text-center\">สถานะ</th>\n                                        <th class=\"text-center\">จัดการ</th>\n                                    </tr>\n                                </thead>\n                                <tbody v-if=\"items.length != 0\">\n                                    <tr v-for=\"(it, idx) in items\" :key=\"idx\">\n                                        <td>\n                                            <img\n                                                :src=\"it.news_file\"\n                                                alt=\"\"\n                                                class=\"img-thumbnail\"\n                                                style=\"width: 100px\"\n                                            />\n                                        </td>\n                                        <td>{{ it.title_th }}</td>\n                                        <td>\n                                            {{ it.news_type.name }}\n                                        </td>\n                                        <td>\n                                            {{ it.department.name_th }}\n                                        </td>\n                                        <td>\n                                            {{\n                                                dayjs(it.created_news)\n                                                    .locale(\"th\")\n                                                    .format(\"DD MMM BB\")\n                                            }}\n                                        </td>\n                                        <th class=\"text-center\">\n                                            <span\n                                                v-if=\"it.is_publish != null\"\n                                                :class=\"\n                                                    'badge rounded-pill bg-' +\n                                                    selectOptions.publishes[\n                                                        it.is_publish\n                                                    ].color\n                                                \"\n                                                >{{\n                                                    selectOptions.publishes[\n                                                        it.is_publish\n                                                    ].name_th\n                                                }}</span\n                                            >\n                                        </th>\n                                        <td\n                                            class=\"text-center\"\n                                            style=\"min-width: 8rem\"\n                                        >\n                                            <NuxtLink\n                                                :to=\"{\n                                                    name: 'admin-news-id',\n                                                    params: { id: it.id },\n                                                }\"\n                                                class=\"btn btn-warning text-uppercase\"\n                                            >\n                                                <i\n                                                    class=\"fa-regular fa-edit\"\n                                                ></i>\n                                            </NuxtLink>\n                                            <a\n                                                :href=\"`../news/${it.id}`\"\n                                                class=\"btn btn-primary text-uppercase ml-10\"\n                                                target=\"_blank\"\n                                            >\n                                                <i\n                                                    class=\"fa-regular fa-eye\"\n                                                ></i>\n                                            </a>\n                                        </td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"col-xxl-12\">\n                    <div class=\"tp-pagination mt-30\">\n                        <blog-pagination\n                            :totalPage=\"totalPage\"\n                            :currentPage=\"currentPage\"\n                            :totalItems=\"totalItems\"\n                            @update:currentPage=\"currentPage = $event\"\n                        />\n                    </div>\n                </div>  \n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport buddhistEra from \"dayjs/plugin/buddhistEra\";\nimport vSelect from \"vue-select\";\nimport \"vue-select/dist/vue-select.css\";\nimport Swal from \"sweetalert2\";\nimport Toastify from \"toastify-js\";\nimport \"toastify-js/src/toastify.css\";\nimport { useRuntimeConfig } from \"#app\";\n\n// import tableItem from \"~/components/list/TableItem.vue\";\nimport BlogPagination from \"~/components/common/pagination/BlogPagination.vue\";\nimport basic_data from \"~~/mixins/basicData\";\n\n// Variable\n\ndayjs.extend(buddhistEra);\n// const route = useRoute();\n// const router = useRouter();\n\nconst config = useRuntimeConfig();\nconst { apiBase } = config.public;\nconst items = ref([]);\nconst perPage = ref(20);\nconst currentPage = ref(1);\nconst totalPage = ref(1);\nconst totalItems = ref(0);\nconst search = ref({});\n\nconst selectOptions = ref({\n    perPage: [\n        { title: \"20\", value: 20 },\n        { title: \"40\", value: 40 },\n        { title: \"60\", value: 60 },\n    ],\n    publishes: basic_data.data().publishes,\n    news_types: [],\n    departments: [],\n});\n\n// Function Fetch\nconst fetchDepartments = async () => {\n    let data = await $fetch(`${apiBase}/department`, {\n        params: {\n            is_publish: 1,\n        },\n    }).catch((error) => error.data);\n\n    selectOptions.value.departments = data.data\n        .map((e) => {\n            return { title: e.name_th, value: e.id };\n        })\n        .filter((x) => {\n            if (\n                useCookie(\"user\").value &&\n                useCookie(\"user\").value.group_id == 2\n            ) {\n                if (x.value == useCookie(\"user\").value.department_id) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n\n            return true;\n        });\n};\n\nconst fetchNewsTypes = async () => {\n    let data = await $fetch(`${apiBase}/news-type`, {\n        params: {\n            is_publish: 1,\n        },\n    }).catch((error) => error.data);\n\n    selectOptions.value.news_types = data.data.map((e) => {\n        return { title: e.name_th, value: e.id };\n    });\n};\n\nconst fetchItems = async () => {\n    let params = {\n        ...search.value,\n        news_type_id:\n            search.value.news_type_id == null\n                ? undefined\n                : search.value.news_type_id.value,\n        perPage: perPage.value,\n        currentPage: currentPage.value,\n    };\n\n    let data = await $fetch(`${apiBase}/news`, {\n        params: params,\n    }).catch((error) => error.data);\n\n    items.value = data.data;\n    totalPage.value = data.totalPage;\n    totalItems.value = data.totalData;\n};\n\n// Watch\nwatch(\n    [currentPage, search],\n    () => {\n        fetchItems();\n        fetchDepartments();\n    },\n    { deep: true }\n);\n\nwatchEffect(() => {\n    if (currentPage.value > totalPage.value)\n        currentPage.value = totalPage.value;\n});\n\n// Event\nonMounted(() => {\n    fetchDepartments();\n    fetchNewsTypes();\n    fetchItems();\n});\n\nuseHead({\n    title: \"รายการข่าว\",\n});\n</script>\n\n<style scoped></style>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2NA,UAAM,OAAO,WAAW;AAIxB,UAAM,SAAS,iBAAgB;AAC/B,UAAM,EAAE,QAAO,IAAK,OAAO;AAC3B,UAAM,QAAQ,IAAI,CAAA,CAAE;AACpB,UAAM,UAAU,IAAI,EAAE;AACtB,UAAM,cAAc,IAAI,CAAC;AACzB,UAAM,YAAY,IAAI,CAAC;AACvB,UAAM,aAAa,IAAI,CAAC;AACxB,UAAM,SAAS,IAAI,CAAA,CAAE;AAErB,UAAM,gBAAgB,IAAI;AAAA,MACtB,SAAS;AAAA,QACL,EAAE,OAAO,MAAM,OAAO,GAAI;AAAA,QAC1B,EAAE,OAAO,MAAM,OAAO,GAAI;AAAA,QAC1B,EAAE,OAAO,MAAM,OAAO,GAAI;AAAA,MAC7B;AAAA,MACD,WAAW,WAAW,KAAI,EAAG;AAAA,MAC7B,YAAY,CAAE;AAAA,MACd,aAAa,CAAE;AAAA,IACnB,CAAC;AAGD,UAAM,mBAAmB,YAAY;AACjC,UAAI,OAAO,MAAM,OAAO,GAAG,OAAO,eAAe;AAAA,QAC7C,QAAQ;AAAA,UACJ,YAAY;AAAA,QACf;AAAA,MACJ,CAAA,EAAE,MAAM,CAAC,UAAU,MAAM,IAAI;AAE9B,oBAAc,MAAM,cAAc,KAAK,KAClC,IAAI,CAAC,MAAM;AACR,eAAO,EAAE,OAAO,EAAE,SAAS,OAAO,EAAE;MAChD,CAAS,EACA,OAAO,CAAC,MAAM;AACX,YACI,UAAU,MAAM,EAAE,SAClB,UAAU,MAAM,EAAE,MAAM,YAAY,GACtC;AACE,cAAI,EAAE,SAAS,UAAU,MAAM,EAAE,MAAM,eAAe;AAClD,mBAAO;AAAA,UAC3B,OAAuB;AACH,mBAAO;AAAA,UACV;AAAA,QACJ;AAED,eAAO;AAAA,MACnB,CAAS;AAAA,IACT;AAcA,UAAM,aAAa,YAAY;AAC3B,UAAI,SAAS;AAAA,QACT,GAAG,OAAO;AAAA,QACV,cACI,OAAO,MAAM,gBAAgB,OACvB,SACA,OAAO,MAAM,aAAa;AAAA,QACpC,SAAS,QAAQ;AAAA,QACjB,aAAa,YAAY;AAAA,MACjC;AAEI,UAAI,OAAO,MAAM,OAAO,GAAG,OAAO,SAAS;AAAA,QACvC;AAAA,MACH,CAAA,EAAE,MAAM,CAAC,UAAU,MAAM,IAAI;AAE9B,YAAM,QAAQ,KAAK;AACnB,gBAAU,QAAQ,KAAK;AACvB,iBAAW,QAAQ,KAAK;AAAA,IAC5B;AAGA;AAAA,MACI,CAAC,aAAa,MAAM;AAAA,MACpB,MAAM;AACF;AACA;MACH;AAAA,MACD,EAAE,MAAM,KAAM;AAAA,IAClB;AAEA,gBAAY,MAAM;AACd,UAAI,YAAY,QAAQ,UAAU;AAC9B,oBAAY,QAAQ,UAAU;AAAA,IACtC,CAAC;AASD,YAAQ;AAAA,MACJ,OAAO;AAAA,IACX,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}