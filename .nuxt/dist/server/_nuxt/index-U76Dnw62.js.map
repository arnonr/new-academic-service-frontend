{"version":3,"file":"index-U76Dnw62.js","sources":["../../../../pages/admin/department/index.vue"],"sourcesContent":["<template>\n    <section class=\"breadcrumb__area include-bg pb-40 pt-30 grey-bg-4\">\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-xxl-12\">\n                    <div class=\"breadcrumb__content p-relative z-index-1\">\n                        <div class=\"breadcrumb__list\">\n                            <span> จัดการข้อมูล </span>\n                            <span class=\"dvdr\"\n                                ><i class=\"fa-solid fa-circle-small\"></i\n                            ></span>\n                            <span> รายการหน่วยงาน </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"portfolio__area pt-40\">\n        <div class=\"container\">\n            <div class=\"mt-10 mb-30 pl-10 pt-15 pb-10 bg-grey\">\n                <h4 class=\"section-bg-primary mb-20\">\n                    <i class=\"fa-solid fa-search\"></i>\n                    <span class=\"ml-10\">ค้นหา</span>\n                </h4>\n\n                <div class=\"col-12 col-lg-12 mb-20\">\n                    <input\n                        class=\"form-control\"\n                        v-model=\"search.name_th\"\n                        name=\"title\"\n                        type=\"text\"\n                        placeholder=\"ชื่อหน่วยงาน\"\n                    />\n                </div>\n\n                <div>\n                    <button class=\"btn btn-success\">ค้นหา</button>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"portfolio__area pb-20\">\n        <div class=\"container\">\n            <div class=\"mt-10 mb-30 pl-10 pt-15 pb-10 bg-grey\">\n                <h4 class=\"section-bg-primary mb-20\">\n                    <i class=\"fa-regular fa-list\"></i>\n                    <span class=\"ml-10\">รายการหน่วยงาน</span>\n                </h4>\n\n                <div class=\"mb-20\">\n                    <button\n                        v-if=\"\n                            useCookie('user').value &&\n                            useCookie('user').value.group_id == 1\n                        \"\n                        type=\"button\"\n                        class=\"btn btn-primary\"\n                        @click=\"\n                            () => {\n                                $router.push({ path: '/admin/department/add' });\n                            }\n                        \"\n                    >\n                        <i class=\"fa-regular fa-plus\"></i>\n                        เพิ่มข้อมูล\n                    </button>\n                </div>\n\n                <div class=\"row gx-2 grid\">\n                    <div class=\"col-12\">\n                        <div class=\"table-responsive\">\n                            <table\n                                class=\"table table-bordered table-striped table-admin\"\n                            >\n                                <thead>\n                                    <tr>\n                                        <th class=\"text-center\">ชื่อ (TH)</th>\n                                        <th class=\"text-center\">ชื่อ (EN)</th>\n                                        <th class=\"text-center\">ลำดับ</th>\n                                        <th class=\"text-center\">สถานะ</th>\n                                        <th class=\"text-center\">จัดการ</th>\n                                    </tr>\n                                </thead>\n                                <tbody v-if=\"items.length != 0\">\n                                    <tr v-for=\"(it, idx) in items\" :key=\"idx\">\n                                        <td cla ss=\"text-center\">\n                                            {{ it.name_th }}\n                                        </td>\n                                        <td class=\"text-center\">\n                                            {{ it.name_en }}\n                                        </td>\n                                        <td class=\"text-center\">\n                                            {{ it.level }}\n                                        </td>\n                                        <th class=\"text-center\">\n                                            <span\n                                                v-if=\"it.is_publish != null\"\n                                                :class=\"\n                                                    'badge rounded-pill bg-' +\n                                                    selectOptions.publishes[\n                                                        it.is_publish\n                                                    ].color\n                                                \"\n                                                >{{\n                                                    selectOptions.publishes[\n                                                        it.is_publish\n                                                    ].name_th\n                                                }}</span\n                                            >\n                                        </th>\n                                        <td class=\"text-center\">\n                                            <NuxtLink\n                                                :to=\"{\n                                                    name: 'admin-department-edit-id',\n                                                    params: { id: it.id },\n                                                }\"\n                                                class=\"btn btn-warning text-uppercase ml-5\"\n                                            >\n                                                <i\n                                                    class=\"fa-regular fa-edit\"\n                                                ></i>\n                                            </NuxtLink>\n\n                                            <button\n                                                class=\"btn btn-danger ml-5\"\n                                                v-if=\"\n                                                    useCookie('user').value &&\n                                                    useCookie('user').value\n                                                        .group_id == 1\n                                                \"\n                                                @click=\"onConfirmDelete(it.id)\"\n                                            >\n                                                <i\n                                                    class=\"fa-regular fa-trash\"\n                                                ></i>\n                                            </button>\n                                        </td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"col-xxl-12\">\n                    <div class=\"tp-pagination mt-30\">\n                        <blog-pagination\n                            :totalPage=\"totalPage\"\n                            :currentPage=\"currentPage\"\n                            :totalItems=\"totalItems\"\n                            @update:currentPage=\"currentPage = $event\"\n                        />\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport buddhistEra from \"dayjs/plugin/buddhistEra\";\nimport \"vue-select/dist/vue-select.css\";\nimport Swal from \"sweetalert2\";\nimport Toastify from \"toastify-js\";\nimport \"toastify-js/src/toastify.css\";\nimport { useRuntimeConfig } from \"#app\";\n// Import\n// import tableItem from \"~/components/list/TableItem.vue\";\nimport BlogPagination from \"~/components/common/pagination/BlogPagination.vue\";\nimport basic_data from \"~~/mixins/basicData\";\n// Variable\n\ndayjs.extend(buddhistEra);\nconst config = useRuntimeConfig();\nconst { apiBase } = config.public;\n// const route = useRoute();\n// const router = useRouter();\nconst items = ref([]);\nconst perPage = ref(20);\nconst currentPage = ref(1);\nconst totalPage = ref(1);\nconst totalItems = ref(0);\nconst search = ref({});\n\nconst selectOptions = ref({\n    perPage: [\n        { title: \"20\", value: 20 },\n        { title: \"40\", value: 40 },\n        { title: \"60\", value: 60 },\n    ],\n    publishes: basic_data.data().publishes,\n});\n\n// Function Fetch\nconst fetchItems = async () => {\n    let params = {\n        ...search.value,\n        perPage: perPage.value,\n        currentPage: currentPage.value,\n    };\n    if (useCookie(\"user\").value && useCookie(\"user\").value.group_id == 2) {\n        params[\"id\"] = useCookie(\"user\").value.department_id;\n    }\n\n    let data = await $fetch(`${apiBase}/department`, {\n        params: params,\n    }).catch((error) => error.data);\n\n    items.value = data.data;\n    totalPage.value = data.totalPage;\n    totalItems.value = data.totalData;\n};\n\n// Watch\nwatch(\n    [currentPage, search],\n    () => {\n        fetchItems();\n    },\n    { deep: true }\n);\n\nwatchEffect(() => {\n    if (currentPage.value > totalPage.value)\n        currentPage.value = totalPage.value;\n});\n\n// Event\nonMounted(() => {\n    fetchItems();\n});\n\nconst onConfirmDelete = async (id) => {\n    Swal.fire({\n        title: \"Are you sure?\",\n        text: \"You won't be able to revert this!\",\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        confirmButtonText: \"Yes, Cancle it!\",\n    }).then((result) => {\n        if (result.isConfirmed) {\n            onDelete(id);\n        }\n    });\n};\n\nconst onDelete = async (id) => {\n    await $fetch(`${apiBase}/department/${id}`, {\n        method: \"delete\",\n    })\n        .then((res) => {\n            if (res.msg == \"success\") {\n                useToast(\"ลบรายการเสร็จสิ้น\", \"success\");\n                fetchItems();\n                window.scrollTo({ top: 0, behavior: \"smooth\" });\n            } else {\n                throw new Error(\"ERROR\");\n            }\n        })\n        .catch((error) => error.data);\n};\n\nuseHead({\n    title: \"รายการหน่วยงาน\",\n});\n\n// definePageMeta({\n//     middleware: \"auth\",\n// });\n</script>\n\n<style scoped></style>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiLA,UAAM,OAAO,WAAW;AACxB,UAAM,SAAS;AACT,UAAA,EAAE,QAAQ,IAAI,OAAO;AAGrB,UAAA,QAAQ,IAAI,CAAA,CAAE;AACd,UAAA,UAAU,IAAI,EAAE;AAChB,UAAA,cAAc,IAAI,CAAC;AACnB,UAAA,YAAY,IAAI,CAAC;AACjB,UAAA,aAAa,IAAI,CAAC;AAClB,UAAA,SAAS,IAAI,CAAA,CAAE;AAErB,UAAM,gBAAgB,IAAI;AAAA,MACtB,SAAS;AAAA,QACL,EAAE,OAAO,MAAM,OAAO,GAAG;AAAA,QACzB,EAAE,OAAO,MAAM,OAAO,GAAG;AAAA,QACzB,EAAE,OAAO,MAAM,OAAO,GAAG;AAAA,MAC7B;AAAA,MACA,WAAW,WAAW,KAAA,EAAO;AAAA,IAAA,CAChC;AAGD,UAAM,aAAa,YAAY;AAC3B,UAAI,SAAS;AAAA,QACT,GAAG,OAAO;AAAA,QACV,SAAS,QAAQ;AAAA,QACjB,aAAa,YAAY;AAAA,MAAA;AAEzB,UAAA,UAAU,MAAM,EAAE,SAAS,UAAU,MAAM,EAAE,MAAM,YAAY,GAAG;AAClE,eAAO,IAAI,IAAI,UAAU,MAAM,EAAE,MAAM;AAAA,MAC3C;AAEA,UAAI,OAAO,MAAM,OAAO,GAAG,OAAO,eAAe;AAAA,QAC7C;AAAA,MACH,CAAA,EAAE,MAAM,CAAC,UAAU,MAAM,IAAI;AAE9B,YAAM,QAAQ,KAAK;AACnB,gBAAU,QAAQ,KAAK;AACvB,iBAAW,QAAQ,KAAK;AAAA,IAAA;AAI5B;AAAA,MACI,CAAC,aAAa,MAAM;AAAA,MACpB,MAAM;AACS;MACf;AAAA,MACA,EAAE,MAAM,KAAK;AAAA,IAAA;AAGjB,gBAAY,MAAM;AACV,UAAA,YAAY,QAAQ,UAAU;AAC9B,oBAAY,QAAQ,UAAU;AAAA,IAAA,CACrC;AAuCO,YAAA;AAAA,MACJ,OAAO;AAAA,IAAA,CACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}