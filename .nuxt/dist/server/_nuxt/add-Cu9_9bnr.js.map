{"version":3,"file":"add-Cu9_9bnr.js","sources":["../../../../pages/admin/serve/add.vue"],"sourcesContent":["<template>\n    <section class=\"breadcrumb__area include-bg pb-40 pt-30 grey-bg-4\">\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-xxl-12\">\n                    <div class=\"breadcrumb__content p-relative z-index-1\">\n                        <div class=\"breadcrumb__list\">\n                            <span> จัดการข้อมูล </span>\n                            <span class=\"dvdr\"\n                                ><i class=\"fa-solid fa-circle-small\"></i\n                            ></span>\n                            <span>\n                                <NuxtLink href=\"/admin/serve\">\n                                    รายการงานบริการวิชาการ\n                                </NuxtLink></span\n                            >\n                            <span class=\"dvdr\"\n                                ><i class=\"fa-solid fa-circle-small\"></i\n                            ></span>\n                            <span> เพิ่มข้อมูล </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"portfolio__area pt-40 pb-40\">\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-12 mb-20\">\n                    <h4>แบบฟอร์มเพิ่มข้อมูล</h4>\n                </div>\n\n                <div class=\"col-12\">\n                    <div class=\"\">\n                        <div class=\"\">\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >หน่วยงาน :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <v-select\n                                            label=\"title\"\n                                            placeholder=\"หน่วยงาน\"\n                                            :options=\"selectOptions.departments\"\n                                            v-model=\"item.department_id\"\n                                            class=\"v-select-no-border\"\n                                            :clearable=\"true\"\n                                        ></v-select>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >ประเภทการบริการวิชาการ :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <v-select\n                                            label=\"title\"\n                                            placeholder=\"ประเภทการบริการวิชาการ\"\n                                            :options=\"\n                                                selectOptions.service_categories\n                                            \"\n                                            v-model=\"item.service_category_id\"\n                                            class=\"v-select-no-border\"\n                                            :clearable=\"true\"\n                                        ></v-select>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >รูปภาพปก :\n                                </label>\n                                <div>\n                                    <input\n                                        ref=\"file\"\n                                        class=\"form-control\"\n                                        type=\"file\"\n                                        id=\"formFile\"\n                                    />\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >หัวข้อ :\n                                </label>\n                                <div>\n                                    <input\n                                        type=\"text\"\n                                        class=\"form-control form-control-plaintext\"\n                                        v-model=\"item.title_th\"\n                                    />\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >รายละเอียด :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <froala\n                                            tag=\"textarea\"\n                                            :config=\"config.detail_th\"\n                                            v-model=\"item.detail_th\"\n                                        ></froala>\n\n                                        <div id=\"detail-th\"></div>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >อัตราค่าใช้บริการ :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <froala\n                                            tag=\"textarea\"\n                                            :config=\"config.rates_th\"\n                                            v-model=\"item.rates_th\"\n                                        ></froala>\n\n                                        <div id=\"detail-th\"></div>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >สถานที่ :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <froala\n                                            tag=\"textarea\"\n                                            :config=\"config.location_th\"\n                                            v-model=\"item.location_th\"\n                                        ></froala>\n\n                                        <div id=\"detail-th\"></div>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >ข้อมูลติดต่อ :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <froala\n                                            tag=\"textarea\"\n                                            :config=\"config.contact_th\"\n                                            v-model=\"item.contact_th\"\n                                        ></froala>\n\n                                        <div id=\"detail-th\"></div>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row mt-10\">\n                                <label for=\"\" class=\"label label-required\"\n                                    >สถานะ :\n                                </label>\n                                <div>\n                                    <client-only>\n                                        <v-select\n                                            label=\"name_th\"\n                                            placeholder=\"การเผยแพร่\"\n                                            :options=\"selectOptions.publishes\"\n                                            id=\"slt-is_publish\"\n                                            v-model=\"item.is_publish\"\n                                            class=\"v-select-no-border\"\n                                            :clearable=\"true\"\n                                        ></v-select>\n                                    </client-only>\n                                </div>\n                            </div>\n\n                            <!-- btn save -->\n                            <div class=\"col-md-12 mt-20\">\n                                <div class=\"contact__btn-2 text-center\">\n                                    <button\n                                        class=\"btn btn-primary\"\n                                        @click=\"onSubmit\"\n                                    >\n                                        บันทึก\n                                    </button>\n                                </div>\n                            </div>\n                            <!--  -->\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport vSelect from \"vue-select\";\nimport \"vue-select/dist/vue-select.css\";\nimport Swal from \"sweetalert2\";\nimport Toastify from \"toastify-js\";\nimport \"toastify-js/src/toastify.css\";\nimport froala_data from \"~~/mixins/froalaData\";\nimport basic_data from \"~~/mixins/basicData\";\nimport { useRuntimeConfig } from \"#app\";\n\nimport buddhistEra from \"dayjs/plugin/buddhistEra\";\ndayjs.extend(buddhistEra);\n\n// Variable\nconst configR = useRuntimeConfig();\nconst { apiBase } = configR.public;\nconst router = useRouter();\n\nconst item = ref({\n    title_th: null,\n    title_en: null,\n    department_id: null,\n    service_category_id: null,\n    detail_th: \"\",\n    detail_en: \"\",\n    is_publish: {\n        id: 1,\n        value: 1,\n        name_th: \"publish\",\n        name_en: \"publish\",\n        color: \"success\",\n    },\n    rates_th: \"\",\n    rates_en: \"\",\n    location_th: \"\",\n    location_en: \"\",\n    contact_th: \"\",\n    contact_en: \"\",\n});\nconst file = ref(null);\n\nconst selectOptions = ref({\n    publishes: basic_data.data().publishes,\n    departments: [],\n    service_categories: [],\n});\n\nconst r = (Math.random() + 1).toString(36).substring(7);\nlet config = {};\n\nconfig[\"detail_th\"] = froala_data.data().froala_config();\nconfig[\"detail_th\"][\"events\"] = {\n    keyup: function (inputEvent) {\n        item.value.detail_th = this.html.get();\n    },\n    click: function (clickEvent) {\n        item.value.detail_th = this.html.get();\n    },\n    \"commands.after\": function (cmd, param1, param2) {\n        item.value.detail_th = this.html.get();\n    },\n    \"paste.after\": function (pasteEvent) {\n        item.value.detail_th = this.html.get();\n    },\n    initialized: function () {\n        this.html.insert(item.value.detail_th);\n    },\n};\n//\nconfig[\"rates_th\"] = froala_data.data().froala_config();\nconfig[\"rates_th\"][\"events\"] = {\n    keyup: function (inputEvent) {\n        item.value.rates_th = this.html.get();\n    },\n    click: function (clickEvent) {\n        item.value.rates_th = this.html.get();\n    },\n    \"commands.after\": function (cmd, param1, param2) {\n        item.value.rates_th = this.html.get();\n    },\n    \"paste.after\": function (pasteEvent) {\n        item.value.rates_th = this.html.get();\n    },\n    initialized: function () {\n        this.html.insert(item.value.rates_th);\n    },\n};\n\nconfig[\"location_th\"] = froala_data.data().froala_config();\nconfig[\"location_th\"][\"events\"] = {\n    keyup: function (inputEvent) {\n        item.value.location_th = this.html.get();\n    },\n    click: function (clickEvent) {\n        item.value.location_th = this.html.get();\n    },\n    \"commands.after\": function (cmd, param1, param2) {\n        item.value.location_th = this.html.get();\n    },\n    \"paste.after\": function (pasteEvent) {\n        item.value.location_th = this.html.get();\n    },\n    initialized: function () {\n        this.html.insert(item.value.location_th);\n    },\n};\n\nconfig[\"contact_th\"] = froala_data.data().froala_config();\nconfig[\"contact_th\"][\"events\"] = {\n    keyup: function (inputEvent) {\n        item.value.contact_th = this.html.get();\n    },\n    click: function (clickEvent) {\n        item.value.contact_th = this.html.get();\n    },\n    \"commands.after\": function (cmd, param1, param2) {\n        item.value.contact_th = this.html.get();\n    },\n    \"paste.after\": function (pasteEvent) {\n        item.value.contact_th = this.html.get();\n    },\n    initialized: function () {\n        this.html.insert(item.value.contact_th);\n    },\n};\n\n// Function Fetch\nconst fetchDepartments = async () => {\n    let data = await $fetch(`${apiBase}/department`, {\n        params: {\n            is_publish: 1,\n        },\n    }).catch((error) => error.data);\n\n    selectOptions.value.departments = data.data\n        .map((e) => {\n            return { title: e.name_th, value: e.id };\n        })\n        .filter((x) => {\n            if (\n                useCookie(\"user\").value &&\n                useCookie(\"user\").value.group_id == 2\n            ) {\n                if (x.value == useCookie(\"user\").value.department_id) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n\n            return true;\n        });\n};\n\nconst fetchServiceCategories = async () => {\n    let data = await $fetch(`${apiBase}/service-category`, {\n        params: {\n            is_publish: 1,\n        },\n    }).catch((error) => error.data);\n\n    selectOptions.value.service_categories = data.data.map((e) => {\n        return { title: e.name_th, value: e.id };\n    });\n};\n\n// Event\nconst onSubmit = async () => {\n    if (\n        item.value.is_publish == null ||\n        item.value.is_publish.value == null ||\n        item.value.service_category_id == null ||\n        item.value.title_th == \"\" ||\n        item.value.title_th == null ||\n        item.value.detail_th == \"\" ||\n        item.value.detail_th == null\n    ) {\n        useToast(\"โปรดระบุข้อมูลให้ครบถ้วน\", \"error\");\n        return;\n    }\n\n    let type_object = {\n        text_success: \"เพิ่มรายการเสร็จสิ้น\",\n        method: \"post\",\n        url: apiBase + \"/serve/\",\n    };\n\n    let data = {\n        ...item.value,\n        serve_file: file.value.files != null ? file.value.files[0] : null,\n        is_publish: item.value.is_publish.value,\n        department_id:\n            item.value.department_id == null\n                ? undefined\n                : item.value.department_id.value,\n        service_category_id:\n            item.value.service_category_id == null\n                ? undefined\n                : item.value.service_category_id.value,\n        created_serve: dayjs().format(\"YYYY-MM-DD\"),\n    };\n\n    var form_data = new FormData();\n    for (var key in data) {\n        form_data.append(key, data[key]);\n    }\n\n    await $fetch(type_object.url, {\n        method: type_object.method,\n        body: form_data,\n    })\n        .then((res) => {\n            if (res.msg == \"success\") {\n                useToast(type_object.text_success, \"success\");\n                router.push({ path: \"/admin/serve/\" });\n            } else {\n                throw new Error(\"ERROR\");\n            }\n        })\n        .catch((error) => error.data);\n};\n\nonMounted(() => {\n    fetchDepartments();\n    fetchServiceCategories();\n});\n\nuseHead({\n    title: \"เพิ่มงานบริการวิชาการ\",\n});\n</script>\n"],"names":[],"mappings":"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"}