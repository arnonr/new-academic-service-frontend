{"version":3,"file":"index-DSGkmWHn.js","sources":["../../../../pages/serve/index.vue"],"sourcesContent":["<template>\n    <section class=\"portfolio__area pt-40 pb-40\">\n        <div class=\"container\">\n            <div class=\"row\">\n                <div\n                    v-for=\"(select, index) in selectOptionsFields\"\n                    :key=\"index\"\n                    class=\"col-md-4 mb-20\"\n                >\n                    <client-only>\n                        <v-select\n                            v-if=\"selectOptions[select.options].length\"\n                            v-model=\"search[select.model]\"\n                            :label=\"select.label\"\n                            :placeholder=\"select.placeholder\"\n                            :options=\"selectOptions[select.options]\"\n                            class=\"v-select-no-border\"\n                            :clearable=\"true\"\n                        />\n                    </client-only>\n                </div>\n\n                <div class=\"col-md-4 mb-20\">\n                    <input\n                        v-model=\"search.text_all\"\n                        class=\"form-control\"\n                        type=\"text\"\n                        placeholder=\"ค้นหางานบริการวิชาการ (พิมพ์ 3 ตัวอักษร)\"\n                    />\n                </div>\n            </div>\n        </div>\n        <div class=\"container\" v-if=\"items.length != 0\">\n            <div class=\"row\">\n                <div class=\"col-lg-12\">\n                    <div class=\"row\">\n                        <div class=\"col-xl-12\">\n                            <div class=\"blog__list-item-wrapper\">\n                                <NewsListItem\n                                    v-for=\"(it, i) in items\"\n                                    :key=\"i\"\n                                    :item=\"mapItemToProps(it)\"\n                                />\n                            </div>\n                        </div>\n                        <div class=\"col-xxl-12\">\n                            <div class=\"tp-pagination mt-30\">\n                                <blog-pagination\n                                    :totalPage=\"totalPage\"\n                                    :currentPage=\"currentPage\"\n                                    :totalItems=\"totalItems\"\n                                    @update:currentPage=\"currentPage = $event\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport vSelect from \"vue-select\";\nimport \"vue-select/dist/vue-select.css\";\nimport { useRuntimeConfig } from \"#app\";\n// Import\nimport NewsListItem from \"~/components/list/ServeListItem.vue\";\nimport BlogPagination from \"~/components/common/pagination/BlogPagination.vue\";\n// Variable\nconst route = useRoute();\nconst router = useRouter();\nconst config = useRuntimeConfig();\nconst { apiBase } = config.public;\n\nconst items = ref([]);\nconst perPage = ref(12);\nconst currentPage = ref(parseInt(route.query.page) || 1);\nconst totalPage = ref(1);\nconst totalItems = ref(0);\nconst search = ref({\n    department_id: null,\n    service_category_id: null,\n    title: \"\",\n    created_year: null,\n    created_month: null,\n    is_publish: 1,\n    text_all: \"\",\n});\n\nconst selectOptionsFields = [\n    {\n        options: \"service_categories\",\n        model: \"service_category_id\",\n        label: \"title\",\n        placeholder: \"ประเภทงานบริการวิชาการ\",\n    },\n    {\n        options: \"departments\",\n        model: \"department_id\",\n        label: \"title\",\n        placeholder: \"หน่วยงาน\",\n    },\n];\n\nconst selectOptions = ref({\n    news_types: [],\n    perPage: [\n        { title: \"20\", value: 20 },\n        { title: \"40\", value: 40 },\n        { title: \"60\", value: 60 },\n    ],\n    service_categories: [],\n    departments: [],\n});\n\n// Function Fetch\nconst fetchOptions = async (endpoint, params = {}) => {\n    try {\n        const { data } = await $fetch(`${apiBase}/${endpoint}`, {\n            params: params,\n        });\n\n        return data.map((e) => {\n            return { title: e.name_th, value: e.id };\n        });\n    } catch (error) {\n        console.error(\"Error fetching \", error);\n        return [];\n    }\n};\n\nconst mapItemToProps = (item) => ({\n    link: \"serve/\",\n    id: item.id,\n    title: item.title,\n    file: item.serve_file,\n    created: item.created_serve,\n    type_name: item.service_category.name_th,\n    dep_name: item.department.name_th,\n});\n\n// fetch\nconst { data: departmentsData } = await useAsyncData(\"departments\", () =>\n    fetchOptions(\"department\", { is_publish: 1 })\n);\n\nselectOptions.value.departments = departmentsData.value;\n\nconst { data: serviceCategoriesData } = await useAsyncData(\n    \"service-categories\",\n    () => fetchOptions(\"service-category\", { is_publish: 1 })\n);\nselectOptions.value.service_categories = serviceCategoriesData.value;\n\nif (route.query.service_category_id != null) {\n    search.value.service_category_id =\n        selectOptions.value.service_categories.find((x) => {\n            return x.value == route.query.service_category_id;\n        });\n}\n\nif (route.query.page) {\n    currentPage.value = route.query.page;\n}\n\nconst { data: res } = await useAsyncData(\"serve\", async () => {\n    let text_all =\n        search.value.text_all.length > 3 ? search.value.text_all : \"\";\n\n    let params = {\n        ...search.value,\n        text_all: text_all,\n        service_category_id: search.value.service_category_id?.value,\n        department_id: search.value.department_id?.value,\n        created_year: search.value.created_year?.value,\n        created_month: search.value.created_month?.value,\n        perPage: perPage.value,\n        currentPage: currentPage.value,\n    };\n\n    let data = await $fetch(`${apiBase}/serve`, {\n        params: params,\n    });\n    items.value = data.data;\n    totalPage.value = data.totalPage;\n    totalItems.value = data.totalData;\n    return data;\n});\n\nitems.value = res.value.data;\ntotalPage.value = res.value.totalPage;\ntotalItems.value = res.value.totalData;\n\nwatch(\n    [currentPage, search],\n    () => {\n        router.replace({\n            name: \"serve\",\n            query: { page: currentPage.value },\n        });\n        refreshNuxtData(\"serve\");\n    },\n    { deep: true }\n);\n\nonMounted(async () => {});\n\nwatchEffect(() => {\n    if (currentPage.value > totalPage.value)\n        currentPage.value = totalPage.value;\n});\n\nuseHead({\n    title: \"งานบริการวิชาการ มจพ.\",\n});\n</script>\n\n<style scoped></style>\n"],"names":["_withAsyncContext"],"mappings":"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"}