{"version":3,"file":"index-grid-Aehx8Xvr.js","sources":["../../../../pages/serve/index-grid.vue"],"sourcesContent":["<template>\n    <section class=\"portfolio__area pt-40 pb-40\">\n        <div class=\"container\" v-if=\"items.length != 0\">\n            <div class=\"row\">\n                <div class=\"col-lg-12\">\n                    <div class=\"row\">\n                        <div class=\"col-xl-12\">\n                            <div class=\"blog__list-item-wrapper\">\n                                <NewsListItem\n                                    v-for=\"(it, i) in items\"\n                                    :key=\"i\"\n                                    :item=\"{\n                                        link: '/serve/',\n                                        id: it.id,\n                                        title: it.title,\n                                        file: it.serve_file,\n                                        created: it.created_serve,\n                                        type_name: it.service_category.name_th,\n                                        dep_name: it.department.name_th,\n                                    }\"\n                                />\n                            </div>\n                        </div>\n                        <div class=\"col-xxl-12\">\n                            <div class=\"tp-pagination mt-30\">\n                                <blog-pagination\n                                    :totalPage=\"totalPage\"\n                                    :currentPage=\"currentPage\"\n                                    :totalItems=\"totalItems\"\n                                    @update:currentPage=\"currentPage = $event\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</template>\n\n<script setup>\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/th\";\nimport vSelect from \"vue-select\";\nimport \"vue-select/dist/vue-select.css\";\n// Import\nimport NewsListItem from \"~/components/list/ServeListItem.vue\";\nimport BlogPagination from \"~/components/common/pagination/BlogPagination.vue\";\n// Variable\nconst route = useRoute();\nconst router = useRouter();\nconst runtimeConfig = useRuntimeConfig();\nconst items = ref([]);\nconst perPage = ref(12);\nconst currentPage = ref(1);\nconst totalPage = ref(1);\nconst totalItems = ref(0);\nconst search = ref({\n    department_id: null,\n    service_category_id: null,\n    title: \"\",\n    created_year: null,\n    created_month: null,\n    is_publish: 1,\n    text_all: \"\",\n});\n\nconst props = defineProps({\n    props_item: {\n        type: Object,\n        required: true,\n    },\n});\n\nconst selectOptions = ref({\n    news_types: [],\n    perPage: [\n        { title: \"20\", value: 20 },\n        { title: \"40\", value: 40 },\n        { title: \"60\", value: 60 },\n    ],\n    service_categories: [],\n    departments: [],\n});\n\n//\n\n// Function Fetch\nconst { data: resDepartment } = await useAsyncData(\"Department\", async () => {\n    let data = await $fetch(`${runtimeConfig.public.apiBase}/department`, {\n        params: {\n            is_publish: 1,\n        },\n    });\n\n    return data;\n});\n\nselectOptions.value.departments = resDepartment.value.data.map((e) => {\n    return { title: e.name_th, value: e.id };\n});\n\nconst { data: resServiceCategory } = await useAsyncData(\n    \"ServiceCategory\",\n    async () => {\n        let data = await $fetch(\n            `${runtimeConfig.public.apiBase}/service-category`,\n            {\n                params: {\n                    is_publish: 1,\n                },\n            }\n        );\n\n        return data;\n    }\n);\n\nselectOptions.value.service_categories = resServiceCategory.value.data.map(\n    (e) => {\n        return { title: e.name_th, value: e.id };\n    }\n);\n\nif (route.query.service_category_id != null) {\n    search.value.service_category_id =\n        selectOptions.value.service_categories.find((x) => {\n            return x.value == route.query.service_category_id;\n        });\n}\n\nif (route.query.page) {\n    currentPage.value = route.query.page;\n}\n\nconst { data: res } = await useAsyncData(\"serve\", async () => {\n    let params = {\n        ...search.value,\n        service_category_id:\n            search.value.service_category_id == null\n                ? undefined\n                : search.value.service_category_id.value,\n        department_id:\n            search.value.department_id == null\n                ? undefined\n                : search.value.department_id.value,\n        created_year:\n            search.value.created_year == null\n                ? undefined\n                : search.value.created_year.value,\n        created_month:\n            search.value.created_month == null\n                ? undefined\n                : search.value.created_month.value,\n        perPage: perPage.value,\n        currentPage: currentPage.value,\n        department_id: props.props_item.department_id,\n    };\n\n    let data = await $fetch(`${runtimeConfig.public.apiBase}/serve`, {\n        params: params,\n    });\n    items.value = data.data;\n    totalPage.value = data.totalPage;\n    totalItems.value = data.totalData;\n    return data;\n});\n\nitems.value = res.value.data;\ntotalPage.value = res.value.totalPage;\ntotalItems.value = res.value.totalData;\n\nwatch(\n    [currentPage, search.value],\n    () => {\n        console.log(\"FREDOM\");\n        router.replace({\n            name: \"serve\",\n            query: { page: currentPage.value },\n        });\n        refreshNuxtData(\"serve\");\n    },\n    { deep: true }\n);\n\nonMounted(() => {});\n\nwatchEffect(() => {\n    if (currentPage.value > totalPage.value)\n        currentPage.value = totalPage.value;\n});\n\n// watch([res], () => {\n//   items.value = res.value.data;\n// });\n\n// watch([resNewsType], () => {\n//   newsType.value = resNewsType.value.data;\n// });\n\nuseHead({\n    title: \"งานบริการวิชาการ\",\n});\n\n</script>\n\n<style scoped></style>\n"],"names":["_withAsyncContext"],"mappings":"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"}